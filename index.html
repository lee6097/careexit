<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>카페 물품 현황</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    .card { border: 1px solid #ccc; padding: 12px; margin-bottom: 10px; border-radius: 8px; }
    .card h3 { margin-top: 0; }
    button { padding: 8px 12px; margin-top: 5px; }
    #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.3); display: none; align-items: center; justify-content: center; }
    #modalContent { background: #fff; padding: 20px; width: 90%; max-width: 400px; border-radius: 10px; }
    label { display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>카페 물품 현황</h1>
  <div id="list"></div>
  <button id="openModal">발주하기</button>

  <div id="modal">
    <div id="modalContent">
      <h2>부족 물품 입력</h2>
      <form id="shortageForm">
        <label>어느 카페입니까?
          <select id="cafeSelect" required>
            <option value="">선택하세요</option>
            <option>카페1</option>
            <option>카페2</option>
            <option>카페3</option>
            <option>카페4</option>
            <option>카페5</option>
            <option>카페6</option>
            <option>카페7</option>
          </select>
        </label>
        <label>무슨 물품이 필요합니까?
          <input type="text" id="itemInput" placeholder="예: 우유 3팩" required />
        </label>
        <button type="submit">전송하기</button>
        <button type="button" id="closeModal">닫기</button>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = 'https://kguyjpeliqwxvaovznvz.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtndXlqcGVsaXF3eHZhb3Z6bnZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMzk4NzcsImV4cCI6MjA4MDgxNTg3N30.zOvqAJhudpXSVLRGUiGcfjqiLGBVSBBh7GqwHUZvMck';
    const supa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const listDiv = document.getElementById('list');
    const modal = document.getElementById('modal');
    const form = document.getElementById('shortageForm');
    const openModalBtn = document.getElementById('openModal');
    const closeModalBtn = document.getElementById('closeModal');

    function renderShortages(data) {
      listDiv.innerHTML = '';
      if (data.length === 0) {
        listDiv.innerHTML = '<p>현재 모든 물품이 충분합니다!</p>';
        return;
      }
      data.forEach(row => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>${row.cafe}</h3>
          <p>${row.item}</p>
          <button data-id="${row.id}">삭제</button>
        `;
        card.querySelector('button').addEventListener('click', async (e) => {
          await supa.from('shortages').delete().eq('id', row.id);
          loadData();
        });
        listDiv.appendChild(card);
      });
    }

    async function loadData() {
      const { data, error } = await supa
        .from('shortages')
        .select('*')
        .order('created_at', { ascending: false });
      if (!error) renderShortages(data);
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const cafe = document.getElementById('cafeSelect').value;
      const item = document.getElementById('itemInput').value.trim();
      if (!cafe || !item) return;
      await supa.from('shortages').insert({ cafe, item });
      form.reset();
      modal.style.display = 'none';
      loadData();
    });

    openModalBtn.addEventListener('click', () => { modal.style.display = 'flex'; });
    closeModalBtn.addEventListener('click', () => { modal.style.display = 'none'; });

    loadData();
  </script>
</body>
</html>


